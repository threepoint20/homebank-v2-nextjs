# 截止日期功能測試指南

## 功能概述
工作可以設定截止日期，逾期完成會有獎勵折扣。

## 測試步驟

### 1. 父母端 - 建立帶截止日期的工作

1. 以父母帳號登入（例如：`threepoint20@test.com`）
2. 進入「工作管理」頁面
3. 點擊「+ 建立新工作」
4. 填寫表單：
   - 工作名稱：例如 "練習鋼琴 30 分鐘"
   - 工作描述：例如 "完成今天的鋼琴練習"
   - 獎勵點數：例如 30
   - **指派給**：選擇特定子女（例如：ariel）
   - **截止日期**：選擇日期和時間（例如：今天下午 6:00）
5. 點擊「建立」

### 2. 檢查工作列表

建立後，在工作管理頁面的表格中應該看到：
- ✅ 工作名稱
- ✅ 描述
- ✅ **指派給**：顯示子女名稱（例如：ariel）
- ✅ **截止日期**：顯示設定的日期時間（例如：01/17 18:00）
- ✅ 指派時間：顯示建立時間
- ✅ 點數：30 點
- ✅ 狀態：進行中（因為已指派給特定子女）

### 3. 子女端 - 查看工作

1. 以子女帳號登入（例如：`ariel@test.com`）
2. 進入「我的工作」頁面
3. 在「進行中的工作」區塊應該看到：
   - ✅ 工作名稱和描述
   - ✅ **截止日期標籤**：
     - 🟢 綠色「充裕時間」：距離截止還有 2 小時以上
     - 🟠 橙色「即將到期」：距離截止不到 2 小時
     - 🔴 紅色「已逾期」：已超過截止時間
   - ✅ 點數：30 點
   - ✅ 「✓ 提交完成」按鈕

### 4. 測試折扣機制

#### 測試案例 1：準時完成（100% 獎勵）
1. 在截止時間前完成工作
2. 子女點擊「✓ 提交完成」
3. 父母審核通過
4. 應該獲得：30 點（100%）

#### 測試案例 2：逾期 1 小時內（70% 獎勵）
1. 設定截止時間為過去 30 分鐘
2. 子女提交工作
3. 父母審核通過
4. 應該獲得：21 點（70%）
5. 審核訊息應顯示：「⚠️ 逾期 1 小時內，獎勵 70%」

#### 測試案例 3：逾期 1.5 小時內（50% 獎勵）
1. 設定截止時間為過去 1.2 小時
2. 子女提交工作
3. 父母審核通過
4. 應該獲得：15 點（50%）
5. 審核訊息應顯示：「⚠️ 逾期 1.5 小時內，獎勵 50%」

#### 測試案例 4：逾期 2 小時內（30% 獎勵）
1. 設定截止時間為過去 1.8 小時
2. 子女提交工作
3. 父母審核通過
4. 應該獲得：9 點（30%）
5. 審核訊息應顯示：「⚠️ 逾期 2 小時內，獎勵 30%」

#### 測試案例 5：逾期超過 2 小時（0% 獎勵）
1. 設定截止時間為過去 3 小時
2. 子女提交工作
3. 父母審核通過
4. 應該獲得：0 點（0%）
5. 審核訊息應顯示：「❌ 逾期超過 2 小時，無獎勵」

#### 測試案例 6：超過當天（扣點）
1. 設定截止時間為昨天
2. 子女提交工作
3. 父母審核通過
4. 應該扣除：-30 點
5. 審核訊息應顯示：「❌ 超過當天，扣除獎勵點數」

## 常見問題排查

### 問題 1：指派給特定子女的工作沒有顯示

**可能原因：**
- 子女的 `parentId` 與父母的 `id` 不匹配
- 工作的 `createdBy` 與父母的 `id` 不匹配

**檢查方法：**
1. 打開瀏覽器開發者工具（F12）
2. 切換到 Console 標籤
3. 子女登入後，應該看到類似的日誌：
```
🔍 子女資訊: {userId: "...", parentId: "...", name: "ariel"}
📋 所有工作: [...]
工作 "練習鋼琴 30 分鐘": {
  createdBy: "...",
  assignedTo: "...",
  isMyParentsJob: true,
  isUnassigned: false,
  isAssignedToMe: true,
  shouldShow: true
}
✅ 過濾後的工作: [...]
```

**解決方法：**
- 確保子女帳號是由該父母創建的
- 確保工作是由該父母創建的

### 問題 2：截止日期沒有顯示

**可能原因：**
- 建立工作時沒有設定截止日期
- 前端沒有正確讀取 `dueDate` 欄位

**檢查方法：**
1. 在工作管理頁面，檢查「截止日期」欄位是否顯示
2. 如果顯示 `-`，表示該工作沒有設定截止日期

**解決方法：**
- 重新建立工作，確保填寫「截止日期」欄位

### 問題 3：折扣計算不正確

**可能原因：**
- 時區問題
- 截止日期格式不正確

**檢查方法：**
1. 查看父母審核時的訊息
2. 檢查是否顯示正確的折扣百分比和實際點數

## 資料庫檢查

如果需要檢查資料庫中的工作資料，可以訪問：
- Vercel Blob Storage 控制台
- 或使用 API：`GET /api/debug/jobs`（如果有實作）

檢查工作物件應包含：
```json
{
  "id": "...",
  "title": "練習鋼琴 30 分鐘",
  "description": "完成今天的鋼琴練習",
  "points": 30,
  "createdBy": "父母ID",
  "assignedTo": "子女ID",
  "assignedAt": "2026-01-17T10:00:00.000Z",
  "dueDate": "2026-01-17T18:00:00.000Z",
  "status": "in_progress",
  "createdAt": "2026-01-17T10:00:00.000Z"
}
```
