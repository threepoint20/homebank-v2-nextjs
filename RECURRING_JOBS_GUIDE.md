# 週期性工作功能說明

## 功能概述

父母可以建立週期性工作，系統會自動重複生成新的工作，不需要每天手動設定。

## 使用方式

### 1. 建立週期性工作

1. 進入「工作管理」頁面
2. 點擊「+ 建立新工作」
3. 填寫基本資訊（標題、描述、點數、指派對象）
4. 設定截止日期（必須）
5. 勾選「🔄 週期性工作」
6. 選擇重複頻率：
   - **每天**：每天自動生成新工作
   - **每週**：可選擇星期幾（例如：週一、週三、週五）
   - **每月**：每月同一天生成新工作
7. 設定結束日期（選填，不設定則持續重複）
8. 點擊「建立」

### 2. 週期類型說明

#### 每天
- 每天自動生成一個新工作
- 截止時間與原始設定相同
- 適合：每日例行工作（如整理房間、洗碗）

#### 每週
- 可選擇一週中的哪幾天
- 例如：週一、週三、週五
- 適合：固定日期的工作（如倒垃圾、澆花）

#### 每月
- 每月同一天生成新工作
- 例如：每月 15 號
- 適合：月度工作（如整理衣櫃、大掃除）


## 自動生成機制

### 觸發時機
系統會在以下時機自動檢查並生成新的週期性工作：
1. 父母開啟「工作管理」頁面時
2. 子女開啟「我的工作」頁面時
3. 可以手動呼叫 API：`POST /api/jobs/recurring`

### 生成規則
- **只生成本週內的工作**：系統只會生成本週（週日到週六）內的工作
- 新工作會保留原始設定（標題、描述、點數、指派對象等）
- 新工作的截止日期會根據週期類型自動計算
- 如果設定了結束日期，超過後就不再生成新工作
- 不會生成已過期的工作（只生成未來的工作）

### 本週範圍
- 本週開始：週日 00:00:00
- 本週結束：週六 23:59:59
- 每週會自動生成該週需要的所有工作

### 避免重複
- 系統會檢查是否已存在相同截止日期的工作
- 不會重複生成相同的工作

## 範例場景

### 場景 1：每天整理房間
- **標題**：整理房間
- **點數**：20
- **指派給**：小明
- **截止日期**：今天 20:00
- **週期**：每天
- **結果**：本週每天 20:00 前都會有一個「整理房間」的工作（週日到週六）

### 場景 2：週一、週三、週五倒垃圾
- **標題**：倒垃圾
- **點數**：10
- **指派給**：小華
- **截止日期**：明天 08:00
- **週期**：每週（週一、週三、週五）
- **結果**：本週的週一、三、五 08:00 前都會有「倒垃圾」的工作

### 場景 3：每月 1 號整理衣櫃
- **標題**：整理衣櫃
- **點數**：50
- **指派給**：小美
- **截止日期**：本月 1 號 18:00
- **週期**：每月
- **結束日期**：今年 12 月 31 日
- **結果**：如果本週包含 1 號，就會生成「整理衣櫃」的工作

## 管理週期性工作

### 查看週期性工作
- 在工作列表中，週期性工作會顯示 🔄 標記
- 顯示週期類型（每天/每週/每月）

### 修改週期性工作
- 目前需要刪除原工作並重新建立
- 未來版本會支援編輯功能

### 停止週期性工作
- 刪除原始的週期性工作
- 已生成的工作不會被刪除，可以繼續完成

## 技術細節

### 相關檔案
- `lib/types.ts` - Job 類型定義
- `lib/utils/recurring-jobs.ts` - 週期性工作工具函數
- `app/api/jobs/recurring/route.ts` - 週期性工作 API
- `app/(parent)/work-management/page.tsx` - 工作管理頁面

### API 端點
- `POST /api/jobs/recurring` - 檢查並生成週期性工作
- `GET /api/jobs/recurring` - 同上（手動觸發）

### 資料結構
```typescript
interface Job {
  // ... 其他欄位
  isRecurring?: boolean;              // 是否為週期性工作
  recurringPattern?: 'daily' | 'weekly' | 'monthly'; // 週期類型
  recurringDays?: number[];           // 每週的哪幾天 (0-6)
  recurringEndDate?: string;          // 週期結束日期
  parentJobId?: string;               // 父工作 ID
}
```

## 注意事項

1. **必須設定截止日期**：週期性工作必須有截止日期才能計算下一次的時間
2. **只顯示本週工作**：子女頁面只會看到本週（週日到週六）的工作
3. **自動生成時機**：只有在頁面載入時才會檢查，不是即時的
4. **結束日期**：如果不設定結束日期，工作會持續生成
5. **已生成的工作**：刪除原始週期性工作不會影響已生成的工作
6. **每週選擇**：使用每週模式時，至少要選擇一天
7. **跨週更新**：每週日開始時，系統會自動生成新一週的工作

## 未來改進

- [ ] 支援編輯週期性工作
- [ ] 支援暫停/恢復週期性工作
- [ ] 支援更複雜的週期規則（如每兩週、每季度）
- [ ] 支援批次管理週期性工作
- [ ] 添加週期性工作的統計報表
