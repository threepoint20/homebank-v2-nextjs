# 工作審核流程說明

## 📋 新的工作流程

### 完整流程
1. **父母建立工作** → 狀態：`pending` 或 `in_progress`
2. **子女接取/被指派工作** → 狀態：`in_progress`
3. **子女提交完成** → 狀態：`completed`（待審核）
4. **父母審核通過** → 狀態：`approved`，發放點數

## 🔄 狀態說明

### pending（待接取）
- 工作剛建立，未指派給任何人
- 所有子女都可以接取
- 顯示：灰色標籤

### in_progress（進行中）
- 工作已被接取或已指派
- 子女正在執行中
- 顯示：藍色標籤

### completed（待審核）⭐ 新增
- 子女已提交完成
- 等待父母審核
- **尚未發放點數**
- 顯示：黃色標籤

### approved（已完成）
- 父母審核通過
- 點數已發放給子女
- 顯示：綠色標籤

## 👶 子女功能

### 1. 接取工作
- 查看「可接取的工作」列表
- 點擊「接取工作」按鈕
- 工作移到「進行中的工作」

### 2. 提交完成
- 在「進行中的工作」區塊
- 點擊「✓ 提交完成」按鈕
- 確認提交
- 工作狀態變為「待審核」
- **不會立即獲得點數**
- 顯示提示：「已提交完成，等待父母審核」

### 3. 查看狀態
- 統計卡片顯示「已完成/審核中」
- 包含 `completed` 和 `approved` 狀態的工作

## 👨‍👩‍👧 父母功能

### 1. 查看待審核工作
- 工作管理頁面
- 統計卡片顯示「待審核」數量
- 工作列表中，待審核工作顯示黃色「待審核」標籤

### 2. 審核工作
- 在工作列表中找到待審核的工作
- 點擊「審核通過」按鈕
- 確認審核
- 系統自動：
  - 更新工作狀態為「已完成」
  - 發放點數給子女
  - 記錄交易歷史
- 顯示提示：「審核通過！已發放 X 點數給 XXX」

### 3. 統計資訊
- 全部工作
- 待接取
- 進行中
- **待審核**（新增）
- 已完成

## 🔌 API 端點

### 子女提交完成
```bash
PUT /api/jobs/[id]
Content-Type: application/json

{
  "userId": "子女ID"
}
```

**回應：**
```json
{
  "success": true,
  "job": {
    "id": "123",
    "status": "completed",
    "completedAt": "2026-01-16T12:00:00.000Z"
  },
  "message": "已提交完成，等待父母審核"
}
```

### 父母審核通過
```bash
POST /api/jobs/[id]/approve
Content-Type: application/json

{
  "parentId": "父母ID"
}
```

**回應：**
```json
{
  "success": true,
  "job": {
    "id": "123",
    "status": "approved",
    "approvedAt": "2026-01-16T12:05:00.000Z"
  },
  "pointsAwarded": 30,
  "childName": "小明"
}
```

## 📊 資料流程

### 子女提交完成
```
1. 檢查工作是否存在
2. 檢查是否為指派對象
3. 檢查工作狀態是否為 in_progress
4. 更新狀態為 completed
5. 記錄完成時間
6. 回傳成功訊息
```

### 父母審核通過
```
1. 檢查父母權限
2. 檢查工作是否存在
3. 檢查工作狀態是否為 completed
4. 更新狀態為 approved
5. 記錄審核時間
6. 計算並發放點數
7. 記錄交易歷史
8. 回傳成功訊息
```

## 🎯 使用場景

### 場景 1：日常家務
**情況**: 子女完成洗碗工作

**流程**:
1. 子女接取「洗碗」工作
2. 完成後點擊「提交完成」
3. 父母檢查廚房是否乾淨
4. 確認無誤後點擊「審核通過」
5. 子女獲得點數

### 場景 2：作業檢查
**情況**: 子女完成作業

**流程**:
1. 父母建立「完成數學作業」工作
2. 子女完成作業後提交
3. 父母檢查作業品質
4. 如果正確，審核通過發放點數
5. 如果有錯誤，可以刪除工作並重新建立

### 場景 3：品質控制
**情況**: 整理房間

**流程**:
1. 子女整理房間後提交完成
2. 父母實地檢查房間整潔度
3. 確認達標後審核通過
4. 確保工作品質

## ✅ 優點

### 1. 品質控制
- 父母可以檢查工作完成品質
- 確保子女認真完成任務
- 培養責任感

### 2. 教育意義
- 教導子女工作需要驗收
- 培養做事認真的態度
- 建立正確的工作觀念

### 3. 公平性
- 避免子女隨意點擊完成
- 確保點數發放的公平性
- 父母有最終決定權

### 4. 靈活性
- 父母可以選擇審核時機
- 可以批次審核多個工作
- 不影響子女繼續接取新工作

## 🔒 權限控制

### 子女權限
- ✅ 接取待接取的工作
- ✅ 提交進行中的工作
- ❌ 審核工作
- ❌ 直接完成工作
- ❌ 發放點數

### 父母權限
- ✅ 建立工作
- ✅ 指派工作
- ✅ 審核工作
- ✅ 發放點數
- ✅ 刪除工作

## 📱 UI 變更

### 子女頁面
- 按鈕文字：「完成工作」→「提交完成」
- 統計卡片：「已完成」→「已完成/審核中」
- 提示訊息：「已提交完成，等待父母審核」

### 父母頁面
- 新增統計：「待審核」卡片
- 新增按鈕：「審核通過」（僅待審核工作顯示）
- 操作欄位：「審核通過」+ 「刪除」

## 🚀 未來改進

### 短期
- [ ] 審核拒絕功能（退回重做）
- [ ] 審核備註功能
- [ ] 批次審核功能

### 中期
- [ ] 審核歷史記錄
- [ ] 審核通知（提醒父母）
- [ ] 工作評分系統

### 長期
- [ ] 自動審核規則（簡單工作自動通過）
- [ ] 工作照片上傳（證明完成）
- [ ] 審核時間限制（超時自動通過）

## 🧪 測試範例

### 測試完整流程
```bash
# 1. 建立工作
curl -X POST http://localhost:3000/api/jobs \
  -H "Content-Type: application/json" \
  -d '{
    "title": "測試工作",
    "points": 20,
    "createdBy": "1",
    "assignedTo": "2"
  }'

# 2. 子女提交完成
curl -X PUT http://localhost:3000/api/jobs/JOB_ID \
  -H "Content-Type: application/json" \
  -d '{"userId": "2"}'

# 3. 父母審核通過
curl -X POST http://localhost:3000/api/jobs/JOB_ID/approve \
  -H "Content-Type: application/json" \
  -d '{"parentId": "1"}'

# 4. 查看點數變化
curl http://localhost:3000/api/users
```

## ⚠️ 注意事項

1. **狀態檢查**
   - 只有 `in_progress` 狀態的工作可以提交
   - 只有 `completed` 狀態的工作可以審核

2. **權限驗證**
   - 子女只能提交指派給自己的工作
   - 父母才能審核工作

3. **點數發放**
   - 只有審核通過後才發放點數
   - 提交完成時不發放點數

4. **交易記錄**
   - 審核通過時才記錄交易
   - 確保交易記錄的準確性
