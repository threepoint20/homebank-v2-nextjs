# 工作指派功能說明

## ✅ 新增功能

### 1. 建立工作時指派給特定子女

父母在建立工作時，可以選擇：
- **所有子女（待接取）**: 工作狀態為 `pending`，所有子女都可以接取
- **指派給特定子女**: 直接指派給某個子女，工作狀態自動變為 `in_progress`

### 2. 工作列表顯示指派對象

在工作管理頁面的表格中，新增「指派給」欄位，顯示：
- 如果工作已指派：顯示子女姓名
- 如果工作待接取：顯示「-」

### 3. Dashboard 顯示子女資訊

父母 Dashboard 新增「子女帳戶」區塊，顯示：
- 子女頭像（如果有上傳）
- 子女姓名
- Email
- 當前點數
- 點擊卡片可前往帳戶管理頁面

## 使用流程

### 建立待接取工作（所有子女可接取）
1. 父母登入系統
2. 前往「工作管理」
3. 點擊「+ 建立新工作」
4. 填寫工作資訊：
   - 工作名稱
   - 工作描述
   - 獎勵點數
5. 「指派給」選擇「所有子女（待接取）」
6. 點擊「建立」
7. 工作狀態為「待接取」
8. 所有子女都可以在「我的工作」頁面看到並接取

### 建立指派工作（直接指派給特定子女）
1. 父母登入系統
2. 前往「工作管理」
3. 點擊「+ 建立新工作」
4. 填寫工作資訊
5. 「指派給」選擇特定子女（例如：小明）
6. 點擊「建立」
7. 工作狀態自動變為「進行中」
8. 只有被指派的子女可以在「我的工作」的「進行中」區塊看到
9. 該子女可以直接完成工作

### 查看子女資訊（Dashboard）
1. 父母登入系統
2. 在 Dashboard 頁面
3. 查看「子女帳戶」區塊
4. 可以看到所有子女的：
   - 頭像
   - 姓名
   - Email
   - 當前點數
5. 點擊任一子女卡片，前往帳戶管理頁面

## 工作狀態說明

### 待接取 (pending)
- 工作剛建立，未指派給任何人
- 所有子女都可以接取
- 顯示灰色標籤

### 進行中 (in_progress)
- 工作已被接取或已指派
- 只有被指派的子女可以完成
- 顯示藍色標籤

### 待審核 (completed)
- 子女已完成工作，等待父母審核
- 目前系統自動審核，此狀態會立即變為「已完成」
- 顯示黃色標籤

### 已完成 (approved)
- 工作已審核通過
- 點數已發放給子女
- 顯示綠色標籤

## API 變更

### 建立工作 API
```bash
POST /api/jobs
Content-Type: application/json

{
  "title": "工作名稱",
  "description": "工作描述",
  "points": 10,
  "createdBy": "父母ID",
  "assignedTo": "子女ID" // 選填，如果有則直接指派
}
```

**回應範例（指派工作）:**
```json
{
  "success": true,
  "job": {
    "id": "1234567890",
    "title": "整理房間",
    "description": "整理自己的房間",
    "points": 10,
    "createdBy": "1",
    "assignedTo": "2",
    "status": "in_progress",
    "createdAt": "2026-01-16T12:00:00.000Z"
  }
}
```

**回應範例（待接取工作）:**
```json
{
  "success": true,
  "job": {
    "id": "1234567890",
    "title": "洗碗",
    "description": "晚餐後洗碗",
    "points": 15,
    "createdBy": "1",
    "status": "pending",
    "createdAt": "2026-01-16T12:00:00.000Z"
  }
}
```

## 資料結構

### Job 型別
```typescript
interface Job {
  id: string;
  title: string;
  description: string;
  points: number;
  createdBy: string;
  assignedTo?: string;  // 指派給的子女 ID（選填）
  status: 'pending' | 'in_progress' | 'completed' | 'approved';
  createdAt: string;
  completedAt?: string;
  approvedAt?: string;
}
```

## 子女視角

### 待接取工作
- 顯示在「可接取的工作」區塊
- 可以點擊「接取工作」按鈕
- 接取後移到「進行中的工作」

### 已指派工作
- 直接顯示在「進行中的工作」區塊
- 無法取消或退回
- 可以點擊「完成工作」按鈕

### 完成工作
- 點擊「完成工作」後
- 系統自動審核並發放點數
- 顯示獲得點數的提示
- 工作移到「已完成」統計

## 使用場景

### 場景 1：家庭共同工作
**情況**: 洗碗、倒垃圾等任何子女都可以做的工作

**操作**:
1. 建立工作時不指派給特定子女
2. 工作狀態為「待接取」
3. 先接取的子女可以完成並獲得點數

### 場景 2：個人專屬工作
**情況**: 整理自己的房間、完成作業等個人工作

**操作**:
1. 建立工作時指派給特定子女
2. 工作直接進入該子女的「進行中」列表
3. 只有該子女可以完成

### 場景 3：輪流工作
**情況**: 本週輪到小明洗碗

**操作**:
1. 建立工作時指派給小明
2. 下週建立新工作時指派給小華
3. 確保工作分配公平

## 優點

### 1. 靈活性
- 支援兩種工作分配方式
- 適應不同的家庭需求

### 2. 公平性
- 待接取工作：先到先得
- 指派工作：確保每個子女都有任務

### 3. 效率
- 直接指派省去接取步驟
- 減少工作搶奪的情況

### 4. 清晰度
- 工作列表清楚顯示指派對象
- 子女知道哪些是自己的工作

## 未來改進

### 短期
- [ ] 允許父母重新指派工作
- [ ] 允許子女拒絕指派的工作
- [ ] 工作到期提醒

### 中期
- [ ] 工作輪流自動分配
- [ ] 工作完成時間記錄
- [ ] 工作評分系統

### 長期
- [ ] 工作模板（常用工作快速建立）
- [ ] 定期工作（每日/每週自動建立）
- [ ] 工作分組（家務、學習、運動等）
- [ ] 工作難度等級

## 測試範例

### 測試建立待接取工作
```bash
curl -X POST http://localhost:3000/api/jobs \
  -H "Content-Type: application/json" \
  -d '{
    "title": "洗碗",
    "description": "晚餐後洗碗",
    "points": 15,
    "createdBy": "1"
  }'
```

### 測試建立指派工作
```bash
curl -X POST http://localhost:3000/api/jobs \
  -H "Content-Type: application/json" \
  -d '{
    "title": "整理房間",
    "description": "整理自己的房間",
    "points": 10,
    "createdBy": "1",
    "assignedTo": "2"
  }'
```

### 測試查詢工作列表
```bash
curl http://localhost:3000/api/jobs
```

## 注意事項

1. **指派對象驗證**
   - 目前未驗證 assignedTo 是否為有效的子女 ID
   - 建議加入驗證邏輯

2. **權限控制**
   - 只有父母可以建立和指派工作
   - 子女只能完成指派給自己的工作

3. **狀態管理**
   - 指派工作自動設定為「進行中」
   - 待接取工作需要子女主動接取

4. **UI 提示**
   - 建立工作時有清楚的說明文字
   - 幫助父母理解兩種模式的差異
