# 週期性工作功能說明

## 功能概述

父母可以建立週期性工作，系統會自動生成多個重複項目，每個項目完成都獲得完整點數。

## 使用方式

### 1. 建立週期性工作

1. 進入「工作管理」頁面
2. 點擊「+ 建立新工作」
3. 填寫基本資訊（標題、描述、點數、指派對象）
4. 設定截止日期和時間（例如：22:00）
5. 勾選「🔄 週期性工作」
6. 選擇重複頻率：
   - **每天**：每天自動生成新工作
   - **每週**：可選擇星期幾（例如：週一、週三、週五）
   - **每月**：每月同一天生成新工作
7. 設定結束日期（選填，不設定則生成未來 30 天）
8. 點擊「建立」

### 2. 週期類型說明

#### 每天
- 每天自動生成一個新工作
- 截止時間與原始設定相同（例如：每天 22:00）
- 適合：每日例行工作（如整理房間、洗碗）

#### 每週
- 可選擇一週中的哪幾天
- 例如：週一、週三、週五
- 適合：固定日期的工作（如倒垃圾、澆花）

#### 每月
- 每月同一天生成新工作
- 例如：每月 15 號
- 適合：月度工作（如整理衣櫃、大掃除）

## 重要特性

### 1. 一次生成多個項目
- 建立週期性工作後，系統會立即生成所有重複項目
- 預設生成未來 30 天（或到結束日期）
- 子女可以看到所有未來的工作

### 2. 每個項目獨立計分
- 每個重複項目都是獨立的工作
- 完成一個項目獲得完整點數
- 不會互相影響

### 3. 統一截止時間
- 所有重複項目使用相同的截止時間
- 例如：設定 22:00，則每天都是 22:00 截止
- 方便養成固定時間完成的習慣


## 自動生成機制

### 觸發時機
系統會在以下時機自動檢查並生成新的週期性工作：
1. 建立週期性工作時立即生成所有重複項目
2. 父母開啟「工作管理」頁面時檢查是否有新項目需要生成
3. 子女開啟「我的工作」頁面時檢查
4. 可以手動呼叫 API：`POST /api/jobs/recurring`

### 生成規則
- **一次生成多個項目**：建立時立即生成所有重複項目
- 預設生成未來 30 天（如果沒有設定結束日期）
- 如果設定了結束日期，生成到結束日期為止
- 每個項目都是獨立的工作，有自己的 ID
- 所有項目使用相同的截止時間（例如：22:00）
- 不會生成已過期的工作（只生成未來的工作）

### 避免重複
- 系統會檢查是否已存在相同截止日期的工作
- 不會重複生成相同的工作

## 範例場景

### 場景 1：每天整理房間
- **標題**：整理房間
- **點數**：20
- **指派給**：小明
- **截止時間**：22:00
- **週期**：每天
- **結束日期**：30 天後
- **結果**：立即生成 30 個工作，每天 22:00 截止，每個完成獲得 20 點

### 場景 2：週一、週三、週五倒垃圾
- **標題**：倒垃圾
- **點數**：10
- **指派給**：小華
- **截止時間**：08:00
- **週期**：每週（週一、週三、週五）
- **結束日期**：2 個月後
- **結果**：生成約 24 個工作（每週 3 次 × 8 週），每個完成獲得 10 點

### 場景 3：每月 1 號整理衣櫃
- **標題**：整理衣櫃
- **點數**：50
- **指派給**：小美
- **截止時間**：18:00
- **週期**：每月
- **結束日期**：今年 12 月 31 日
- **結果**：生成剩餘月份的工作，每個完成獲得 50 點

## 管理週期性工作

### 查看週期性工作
- 在工作列表中，週期性工作會顯示 🔄 標記
- 顯示週期類型（每天/每週/每月）

### 修改週期性工作
- 目前需要刪除原工作並重新建立
- 未來版本會支援編輯功能

### 停止週期性工作
- 刪除原始的週期性工作
- 已生成的工作不會被刪除，可以繼續完成

## 技術細節

### 相關檔案
- `lib/types.ts` - Job 類型定義
- `lib/utils/recurring-jobs.ts` - 週期性工作工具函數
- `app/api/jobs/recurring/route.ts` - 週期性工作 API
- `app/(parent)/work-management/page.tsx` - 工作管理頁面

### API 端點
- `POST /api/jobs/recurring` - 檢查並生成週期性工作
- `GET /api/jobs/recurring` - 同上（手動觸發）

### 資料結構
```typescript
interface Job {
  // ... 其他欄位
  isRecurring?: boolean;              // 是否為週期性工作
  recurringPattern?: 'daily' | 'weekly' | 'monthly'; // 週期類型
  recurringDays?: number[];           // 每週的哪幾天 (0-6)
  recurringEndDate?: string;          // 週期結束日期
  parentJobId?: string;               // 父工作 ID
}
```

## 注意事項

1. **必須設定截止日期**：週期性工作必須有截止日期才能生成重複項目
2. **一次生成多個**：建立時會立即生成所有重複項目（預設 30 天）
3. **每個項目獨立**：每個重複項目都是獨立的工作，完成都獲得完整點數
4. **統一截止時間**：所有重複項目使用相同的截止時間
5. **結束日期**：如果不設定結束日期，預設生成未來 30 天
6. **已生成的工作**：刪除原始週期性工作不會影響已生成的工作
7. **每週選擇**：使用每週模式時，至少要選擇一天
8. **自動檢查**：系統會定期檢查是否需要生成新的項目

## 未來改進

- [ ] 支援編輯週期性工作
- [ ] 支援暫停/恢復週期性工作
- [ ] 支援更複雜的週期規則（如每兩週、每季度）
- [ ] 支援批次管理週期性工作
- [ ] 添加週期性工作的統計報表
